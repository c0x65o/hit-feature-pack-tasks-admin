# Feature Pack: job-core
# Core job management UI (execution history + scheduling)

name: job-core
title: System Jobs
description: "Core job management UI: execution history, schedules, and admin tools"

derived_services:
  - name: job
    description: Job execution worker
    run_mode: jobs
    command: node .hit/generated/hit_tasks_worker.cjs
    base_services_from: tasks
    requires_tasks: true
    options_key: worker
    env:
      HIT_TASKS_BASE_SERVICE: "{{base_service}}"
      HIT_APP_URL: "{{base_service_url}}"
    env_from_manifest:
      HIT_TASKS_CRON_TZ: reporting.timezone
    required_files:
      - .hit/generated/hit_tasks_worker.cjs
      - .hit/generated/hit_tasks_manifest.json

# Route definitions - mapped to React components
routes:
  - path: /admin/jobs
    page: TaskList
    roles: []
    default_roles_allow: [admin]
    authz: { entity: list, verb: read, require_mode: any }
  - path: /admin/jobs/executions
    page: AllExecutions
    roles: []
    default_roles_allow: [admin]
    authz: { entity: results, verb: read, require_mode: any }
  - path: /admin/jobs/[name]
    page: TaskDetail
    roles: []
    default_roles_allow: [admin]
    authz: { entity: list, verb: read, require_mode: any }
  - path: /admin/jobs/[name]/executions/[id]
    page: TaskExecution
    roles: []
    default_roles_allow: [admin]
    authz: { entity: results, verb: read, require_mode: any }

# Navigation contributions - auto-added to shell sidebar
nav:
  - id: jobs
    label: Jobs
    icon: CirclePlay
    group: system
    roles: [admin]
    showWhen: authenticated
    weight: 900
    children:
      - id: jobs-list
        label: List
        path: /admin/jobs
        icon: ListChecks
        weight: 100
        roles: [admin]
        showWhen: authenticated
      - id: jobs-executions
        label: Results
        path: /admin/jobs/executions
        icon: History
        weight: 110
        roles: [admin]
        showWhen: authenticated

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Action definitions (for admin-core permissions UI + runtime checks)
# ─────────────────────────────────────────────────────────────────────────────
# Permissions are schema-driven and live under:
#   schema/permissions.yaml

# Dependencies
requires:
  modules: [tasks]

